Metadata-Version: 2.4
Name: variance
Version: 0.1.0
Summary: Systematic Volatility Engine
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: yfinance>=0.2.0
Requires-Dist: pandas>=1.5.0
Requires-Dist: numpy>=1.20.0
Requires-Dist: rich>=12.0.0
Requires-Dist: scipy>=1.7.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: ruff>=0.14.0; extra == "dev"
Requires-Dist: pre-commit>=4.0.0; extra == "dev"

# Variance: Systematic Volatility Engine

[![Python 3.10+](https://img.shields.io/badge/python-3.10%2B-blue.svg)](https://www.python.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Philosophy: Tastylive](https://img.shields.io/badge/Philosophy-Tastylive-red.svg)](https://www.tastylive.com/)
[![Test Coverage: 64%](https://img.shields.io/badge/coverage-64%25-yellow.svg)]()

**Variance** is a quantitative analysis engine designed for systematic options traders. It transforms raw market data and broker positions into an institutional-grade triage dashboard, focusing exclusively on **Price**, **Volatility**, and **Mechanics**.

Built on the Tastylive philosophy, Variance rejects market narratives in favor of statistical edge, specifically exploiting the **Volatility Risk Premium (VRP)** through net-premium selling strategies.

Variance uses institution-grade **Logarithmic Distance** for all volatility calculations, ensuring mathematical objectivity across different asset scales and price regimes.

---

## üìö **New Developer Onboarding**

**For contractors or AI agents taking over this project:**

| Document | Purpose | Time to Read |
|----------|---------|--------------|
| **[HANDOFF.md](docs/HANDOFF.md)** | Complete project overview, architecture, patterns, workflow | 30 min |
| **[QUICK_REFERENCE.md](docs/QUICK_REFERENCE.md)** | One-page cheat sheet for daily commands | 5 min |
| **[TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md)** | Solutions to common issues | As needed |
| **[DEVELOPMENT_PRIORITIES.md](docs/DEVELOPMENT_PRIORITIES.md)** | What to work on next, priority backlog | 15 min |

**Quick Start Path:**
1. Read [HANDOFF.md](docs/HANDOFF.md) for complete context
2. Keep [QUICK_REFERENCE.md](docs/QUICK_REFERENCE.md) open while coding
3. Check [DEVELOPMENT_PRIORITIES.md](docs/DEVELOPMENT_PRIORITIES.md) for next tasks
4. Refer to [TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) when stuck

**Current Status (Dec 25, 2024):**
- **Version:** 0.1.0 (Active Development)
- **Test Coverage:** 64% (Target: 75%)
- **Passing Tests:** 411/418 (7 integration tests failing - market data dependencies)
- **Quality Gates:** All passing (ruff, mypy, radon-cc)
- **Next Priority:** Fix failing tests, improve Tastytrade client coverage (14% ‚Üí 70%)

---

## üõ† Architecture & Standards

### üß© Modular Design (RFC 016‚Äì019)
Variance has been refactored into a modular, pattern-driven quantitative engine:
- **`src/variance/triage/`**: **Chain of Responsibility** for multi-tag action detection.
- **`src/variance/screening/`**: **Template Method** pipeline for composable market research.
- **`src/variance/classification/`**: **Registry Pattern** for deterministic strategy identification.
- **`src/variance/strategies/`**: **Strategy Pattern** for idiosyncratic trade mechanics (Strangles, Calendars, Butterflies).
- **`src/variance/get_market_data.py`**: Resilient data layer with a thread-safe SQLite (WAL) cache.

### üìê The Quantitative Standard
Unlike retail tools that use arithmetic subtraction ($IV - HV$), Variance operates in **Logarithmic Space**.
- **Scale Symmetry**: A 1-point move in a low-vol asset has the same mathematical weight as a relative move in a high-vol asset.
- **Z-Score Foundational**: All signals are derived from how many units of historical movement the current price covers.
- **Stoic Logic**: "Subtraction is noise; Division is signal."

---

## üìä The Dashboard

Variance provides a high-fidelity terminal interface (TUI) for real-time portfolio management and opportunity scanning.

```text
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ THE CAPITAL CONSOLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ ‚Ä¢ Net Liq:  $50,000.00        ‚Ä¢ Open P/L: $3,336.26  ‚îÇ
‚îÇ ‚Ä¢ BP Usage: 28.5% (Deploy)    ‚Ä¢ Status:   Harvesting ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ THE GYROSCOPE (Risk)                         THE ENGINE (Exposure)                ‚îÇ
‚îÇ ‚Ä¢ Tilt:      Neutral (27 Œî)                  ‚Ä¢ Downside:  $-1,040.09 (Crash -5%)  ‚îÇ
‚îÇ ‚Ä¢ Theta:     $62.55 ‚Üí $129.54 (+107% VRP)    ‚Ä¢ Upside:    $812.20 (Rally +5%)     ‚îÇ
‚îÇ ‚Ä¢ Stability: 0.21 (Stable)                   ‚Ä¢ Mix:       üåç Diversified (0.15 œÅ) ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ

üîç VOL SCREENER OPPORTUNITIES
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ Symbol   ‚îÇ     Price ‚îÇ  VRP(S) ‚îÇ  VRP(T) ‚îÇ   IVP ‚îÇ   Rho ‚îÇ   Yield ‚îÇ  Earn ‚îÇ Signal       ‚îÇ  Vote   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ /6A      ‚îÇ     $0.67 ‚îÇ    1.59 ‚îÇ    2.99 ‚îÇ   100 ‚îÇ  0.47 ‚îÇ  509.3% ‚îÇ   N/A ‚îÇ RICH ‚Üë‚Üë      ‚îÇ  SCALE  ‚îÇ
‚îÇ WB       ‚îÇ    $10.08 ‚îÇ   10.09 ‚îÇ   18.24 ‚îÇ    64 ‚îÇ  0.34 ‚îÇ   12.4% ‚îÇ   -36 ‚îÇ RICH ‚Üë‚Üë      ‚îÇ   BUY   ‚îÇ
‚îÇ AHCO     ‚îÇ    $10.24 ‚îÇ    9.32 ‚îÇ   12.36 ‚îÇ    99 ‚îÇ -0.17 ‚îÇ   12.6% ‚îÇ   -50 ‚îÇ RICH ‚Üë‚Üë      ‚îÇ   BUY   ‚îÇ
‚îÇ VALE     ‚îÇ    $13.15 ‚îÇ    1.75 ‚îÇ    1.71 ‚îÇ    58 ‚îÇ  0.51 ‚îÇ    8.6% ‚îÇ    56 ‚îÇ RICH         ‚îÇ  LEAN   ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

---

## üß† Core Philosophy (The Variance Code)

Variance is engineered to enforce three primary mechanical pillars:

1.  **Sell Premium (The Edge):** We are net sellers of options to harvest time decay (Theta) and exploit the fact that implied volatility (IV) historically overstates actual movement (HV).
2.  **Alpha-Theta (The Engine):** We optimize for **Expected Yield**. Variance adjusts raw Theta for institutional VRP ratios to identify "Toxic Theta" (underpaid risk) vs. "Alpha Theta" (overpaid premium).
3.  **Law of Large Numbers:** We prioritize **Occurrences over Home Runs**. The system nudges you to "Trade Small, Trade Often" to allow probabilities to realize over hundreds of independent trades.

---

## üöÄ Key Features

### üì° Dual-VRP Synthesis (Tastytrade Native)
Monitors both **Structural (90d)** and **Tactical (30d)** volatility regimes using institution-grade data. The engine identifies alpha-rich momentum where the cost of insurance is expanding relative to long-term norms.

### üõ°Ô∏è Probabilistic Triage
Automatically flags positions using unified risk rules:
*   **üí∞ HARVEST:** Profit > 50% (Lock in winners).
*   **üõ°Ô∏è DEFENSE:** Positions entering the 21-DTE Gamma Zone or breaching strikes.
*   **üíÄ TOXIC:** Negative expectancy trades where statistical cost > premium collected.
*   **‚ûï SCALABLE:** Positions where the volatility edge is surging (VRP Divergence ‚Üë‚Üë).

### üö¶ The Retail Efficiency Gate
A mechanical habit-enforcer that filters out "toxic" retail trades:
*   **Price Floor ($25):** Ensures manageable Gamma and strike density for rollability.
*   **Slippage Guard:** Rejects options with wide Bid/Ask spreads (> 5%).

### üó≥Ô∏è Institutional Allocation Vote
A definitive clinical recommendation for every candidate:
*   **BUY:** High statistical edge combined with low portfolio correlation.
*   **SCALE:** Recommendation to increase size on existing surging alpha.
*   **LEAN:** Good opportunity but requires caution on diversification.
*   **AVOID:** High-risk setups with excessive correlation or poor mechanics.

---

## üèÅ Getting Started

### Prerequisites
*   Python 3.10+
*   Tastytrade API Credentials (OAuth)
*   A CSV export of your positions (Standard Tastytrade format).

### Installation

```bash
# 1. Clone and Enter
git clone https://github.com/epj009/variance-yfinance.git variance
cd variance

# 2. Setup Environment
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 3. Configure Credentials
# Create a .env.tastytrade file:
export TT_CLIENT_ID='your_id'
export TT_CLIENT_SECRET='your_secret'
export TT_REFRESH_TOKEN='your_token'
```

---

## üöÄ Usage

### 1. Daily Portfolio Triage
The primary command for managing existing risk. It finds your latest CSV, runs the analysis pipeline, and renders the TUI.
```bash
./variance
```

### 2. Volatility Screener
Scan your watchlist for high-probability entries based on tactical VRP markups.
```bash
python3 scripts/vol_screener.py
```

### 3. Quantitative Research Lab
Run deeper audits on your portfolio's "Alpha-Theta" quality and sector concentration.
```bash
python3 util/research_lab.py
```

### 4. Showcase Demo
View the system's full capabilities using a pre-configured institutional showcase portfolio.
```bash
./variance --demo
```

---

## ‚öôÔ∏è Customization

Variance is fully externalized. Tune your "Nightmare Scenarios" and trading thresholds in `config/trading_rules.json`:

*   **Net Liquidity:** Calibrates risk-sizing and whale-detection.
*   **DTE Windows:** Defaulted to **20‚Äì70 days** to capture entire monthly cycles.
*   **Liquidity Gates:** Defaulted to **Open Interest (OI)** for stability across all market hours.

---

## ‚ö†Ô∏è Disclaimer
Variance is a research and automation tool for quantitative analysts. **It does not provide financial advice.** Options trading involves significant risk of loss. The developers are not responsible for any financial outcomes resulting from the use of this software.
